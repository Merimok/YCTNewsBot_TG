# AutoNews
[English version](README.en.md)

AutoNews — это Telegram-бот, который автоматически собирает новости из RSS-лент, генерирует краткие пересказы на русском языке с помощью ИИ (OpenAI) и публикует их в заданный Telegram-канал. Бот поддерживает управление настройками, администрирование и мониторинг через команды в Telegram.

## Основные функции

- **Автоматический парсинг новостей**: Собирает новости из популярных RSS-лент (The Verge, TechCrunch, Ars Technica и др.).
- **Генерация контента с помощью ИИ**: Использует OpenAI (например, модель `gpt-4o-mini`) для создания заголовков и кратких пересказов новостей на русском языке.
- **Публикация в Telegram**: Автоматически публикует новости в указанный канал с заданным интервалом.
- **Управление настройками**: Поддерживает настройку интервалов постинга, смену модели ИИ, редактирование промпта и управление администраторами.
- **Кэширование и фильтрация**: Использует SQLite для хранения кэша новостей и предотвращения дублирования.
- **Мониторинг и логирование**: Ведёт статистику постов, ошибок и дублей, отправляет уведомления об ошибках (опционально).
- **Резервное копирование**: Позволяет выгружать и загружать базу данных SQLite через Telegram.

## Требования

- Python 3.10+
- Библиотеки:
  ```bash
  pip install flask feedparser requests openai
  ```
- Переменные окружения:
  - `TELEGRAM_TOKEN`: Токен вашего Telegram-бота.
  - `OPENAI_API_KEY`: Ключ API для OpenAI.
- Telegram-канал, где бот имеет права администратора.

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/goreforced/YCTNewsBot_TG.git
   cd YCTNewsBot_TG
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Настройте переменные окружения:
   ```bash
   export TELEGRAM_TOKEN="your-telegram-bot-token"
   export OPENAI_API_KEY="your-openai-api-key"
   ```

4. Запустите приложение:
   ```bash
   python bot.py
   ```

5. Настройте вебхук для Telegram:
   - Убедитесь, что ваш сервер доступен через HTTPS.
   - Отправьте запрос:
     ```bash
     curl -F "url=https://your-server.com/webhook" https://api.telegram.org/bot<your-telegram-token>/setWebhook
     ```

## Использование

1. Добавьте бота в Telegram-канал и сделайте его администратором.
2. Взаимодействуйте с ботом через команды в Telegram:

   **Основные команды**:
   - `/start` — Привязать канал или проверить доступ.
   - `/startposting` — Начать автоматический постинг.
   - `/stopposting` — Остановить постинг.
   - `/setinterval <time>.

   **Настройка**:
   - `/editprompt` — Изменить промпт для ИИ.
   - `/changellm <model>` — Сменить модель ИИ (например, `gpt-4o-mini`).
   - `/errnotification <on/off>` — Включить/выключить уведомления об ошибках.

   **Мониторинг**:
   - `/info` — Показать статус бота.
   - `/errinf` — Показать последние ошибки.
   - `/feedcache` — Показать кэш новостей.
   - `/feedcacheclear` — Очистить кэш.

   **Администрирование**:
   - `/addadmin <@username>` — Добавить администратора.
   - `/removeadmin <@username>` — Удалить администратора.
   - `/sqlitebackup` — Выгрузить базу данных.
   - `/sqliteupdate` — Загрузить базу данных.

   **Дополнительно**:
   - `/nextpost` — Сбросить таймер и запостить немедленно.
   - `/skiprss` — Пропустить следующий RSS-источник.
   - `/help` — Показать список команд.

## Структура базы данных

Бот использует SQLite (`feedcache.db`) для хранения данных. Основные таблицы:

- `feedcache`: Кэш новостей (ID, заголовок, пересказ, ссылка, источник, время).
- `channels`: Информация о каналах (ID канала, создатель).
- `admins`: Список администраторов канала.
- `config`: Настройки (промпт, модель ИИ, уведомления об ошибках).
- `errors`: Лог ошибок (время, сообщение, ссылка).

## Логирование

- Логи выводятся в консоль в формате: `%(asctime)s - %(levelname)s - %(message)s`.
- Уровень логирования: `INFO`.

## Ограничения

- Бот работает только с публичными RSS-лентами.
- Для генерации контента требуется действующий ключ OpenAI API.
- Telegram ограничивает длину сообщений до 4096 символов, поэтому длинные пересказы обрезаются.
- Бот должен быть администратором в целевом канале.

## Лицензия

GPL-3.0 License. См. файл `LICENSE` для подробностей.

## Контакты

Если у вас есть вопросы или предложения, создайте issue в репозитории.

